@{
    ViewBag.Icono = "fas fa-boxes";
    ViewBag.Title = "Solicitar";

}



<seccion class="card col-12 offset-md-2 col-md-7" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">


    <div class="margenSection row" style="margin-bottom: 60px; ">


        <div class="btn-block">
        </div>


        <div class="col-12 col-md-6  btn-block">
            <button type="button" class="btn btn-primary btn-lg  btn-block">Crear Nueva Solicitud</button>

        </div>

        <div class="col-12 col-md-6  btn-block">
            <button type="button" class="btn btn-primary btn-lg  btn-block">Historico de Solicitudes</button>

        </div>

    </div>

</seccion>




<!-- Seccion para llenar los campos de la solicitud de uno o mas bancos  -->
<section class="card margenSection col-12 offset-md-2 col-md-7">

    <br />
    <h5 class="col-12 text-center text-uppercase">Llene los siguientes campos para realizar la solicitud de formas de pago</h5>
    <br />

    <form >
        <!--Seleccionar banco-->
        <div class="row">

            <div class=" col-12 text-center offset-md-1 col-md-3 text-md-right">
                <label class="text-capitalize">  Banco:</label>
            </div>

            <div class=" col-12 col-md-6">
                <div class="form-group">
                    <select class="form-control" id="SeleccionBanco" name="SeleccionBanco" required >
                        <option value="" disabled selected>Selecciona un banco...</option>
                        @foreach (var banco in ViewBag.ListaNombreBancos)
                        {


                            <option>@banco  </option>


                        }

                    </select>
                </div>
            </div>



        </div>

        <!-- Muestra el numero de la cuenta filtrado por el banco seleccionado-->
        <div class="row">
            <label class=" col-12 text-center offset-md-1 col-md-3 text-md-right ">Cuenta:</label>
            <span id="NumeroDeCuenta" class=" offset-1 col-10 text-center offset-md-0 col-md-6  border border-primary rounded-pill h4" title="Numero de cuenta activa"></span>

        </div>
        <br />

        <!--Input para la cantidad de formas que desea solicitar el usuario-->
        <div class="row">
            <label class=" col-12 text-center offset-md-1 col-md-3 text-md-right">Cantidad:</label>
            <input id="CantidadFormas" class="offset-1 col-10 offset-md-0 col-md-6" placeholder="Ingrese C. de formas a solicitar" type="number" pattern=" 0+\.[0-9]*[1-9][0-9]*$" name="itemConsumption" onkeypress="return event.charCode >= 48 && event.charCode <= 57" required />
        </div>
        <br />

        <!--- Input para el folio inicial -->
        <div class="row ">
            <label class="col-12 text-center offset-md-1 col-md-3 text-md-right">Folio Inicial:</label>
            <input id="FInicial" class="offset-1 col-10 offset-md-0 col-md-6" placeholder="Ingrese F. inicial a solicitar" type="text" pattern="[A-Za-z0-9]" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " required />
        </div>

        <br />
        <a type="submit" class="col-12 text-center offset-md-3 col-md-6 btn btn-outline-success">
            Agregar Banco a la solicitud
        </a>

    </form>


    <br />

</section>




<!-- Genera la tabla para que se puedan editar los datos que se van agregando antes de poderlos agregar al historico -->

<section class="margenSection table-responsive" id="TablaDeContenedores">

    <table class="table table-striped table-bordered table-hover">
        <caption id="TituloDeCaption"></caption>
        <thead>
            <tr>
                <th>Banco</th>
                <th>cuenta</th>
                <th>Cantidad</th>
                <th>Folio Inicial</th>
                <th></th>


            </tr>
        </thead>

        <tbody id="prueba">

            <template id="temp">
                <tr>

                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>

                </tr>

            </template>



        </tbody>
    </table>





</section>

<br />
<br />
<button type="button" id="Guardar" class="btn btn-primary col-10 offset-1" onclick="EnviarDatos()">Guardar Contenedores Existentes</button>
<br />
<br />







































<!-- Generacion de tabla del Historico de las solicitudes de formas de pago  -->
<section class="margenSection ">

    <div class="table-responsive">

        <table id="tbProducto" class="table table-striped table-bordered table-hover">
            <caption class="text-uppercase">Solicitudes creadas recientemente</caption>


            <thead class="tabla">
                <tr>
                    <th>Id</th>
                    <th>Cuenta Bancaria</th>
                    <th>dato1</th>
                    <th>dato2</th>
                    <th>dato3</th>
                    <th>dato4</th>
                    <th>dato5</th>
                    <th>dato6</th>
                    <th>

                    </th>
                    <th>

                    </th>



                </tr>
            </thead>
            <tbody>



                @*@foreach (var modelo in Model)
                    {
                        <tr>
                            <td>@modelo.Id</td>
                            <td>@modelo.NombreBanco</td>
                            <td>@modelo.FormasDisponibles</td>
                            <td>@modelo.UltimoFolioInventario</td>
                            <td>@modelo.UltimoFolioQuincena</td>
                            <td>@modelo.FormasQuincena1</td>
                            <td>@modelo.FormasQuincena2</td>
                            <td>@modelo.EstimadoMeses</td>
                            <th>
                                <button type="button" class="agregar btn btn-success" data-toggle="modal" data-target="#staticBackdrop">Agregar</button>
                            </th>
                            <th>
                                <button type="button" class="agregar btn btn-primary">Inhabilitados</button>
                            </th>

                        </tr>


                    }*@


            </tbody>
        </table>
    </div>


</section>











<!-- INICIO DE MODALES -->
<section class="modal fade" id="BancoAgregado" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">


                <h5 class="col-11 text-center"> Bancos agregados a solicitud</h5>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>


            </div>



            <div class="modal-body">

                {Mostrar lista de bancos}

                <br />

            </div>


            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="">Descargar Solicitud</button>




            </div>


        </div>
    </div>
</section>












<script>
      $(document).ready(function () {
        //detecta cambios en el banco
          let bancoSeleccionado = null;
          let cuentaBanco = null;
            
        const seleccionBanco = document.getElementById("SeleccionBanco");
        seleccionBanco.addEventListener("change",
            function () {

                bancoSeleccionado = this.options[seleccionBanco.selectedIndex];
                console.log(bancoSeleccionado.value);


               var DatosEnviar = "{'BancoSeleccionado': '" + bancoSeleccionado.value + "' }";


               $.ajax({
                   url: '@Url.Action("ObtenerCuentaBancaria", "Inventario")',
                   data: DatosEnviar,
                  type: "POST",
                  contentType: "application/json; charset=utf-8",

                   success: function (msg)
                   {
                       console.log("msg", msg);
                       console.log("msg", msg.length);

                       //se msg es falso es porque la variable cuenta bancaria esta vacia
                       if (msg === false) {
                           Swal.fire({
                               backdrop: true,

                               allowEnterKey: false,
                               icon: 'error',
                               title: 'Problema al obtener la cuenta del banco seleccionado',
                               text: 'No se pudo cargar el numero de la cuenta intentelo mas tarde o pongase en contacto con el administrador del sistema',

                           })

                       } else
                       {
                           cuentaBanco = msg;
                           document.getElementById('NumeroDeCuenta').innerHTML = msg;

                       }

                


                   },error: function (msg) {
                       Swal.fire({
                           icon: 'error',
                           title: 'Oops...',
                           text: 'Esto no deberia pasar intentelo de nuevo por favor!',
                           footer: '<a>Si necesita ayuda pongase en contacto con el administrador</a>'
                       })
                   }
               });


            }
        );


          let cantidadFormas = null;
          let FolioInicial = null;

        //  const Validacion = document.getElementById("Validar");
        //Validacion.addEventListener("click",
        //  function () {

        //      //bancoSeleccionado.value
        //      //cuentaBanco.value
        //      //CantidadFormas
        //      //FInicial

        //      cantidadFormas = document.getElementById('CantidadFormas');
        //      FolioInicial = document.getElementById('FInicial');

        //      console.log(bancoSeleccionado.value);
        //      console.log(cuentaBanco.value);
        //      console.log(cantidadFormas.value);
        //      console.log(FolioInicial.value);

        //      //doc
         
              
        //  }
        //);














        @*//Enviar Datos al SERVER-->
        var GuardarDatos = document.getElementById("GuardarAjuste");
        GuardarDatos.addEventListener("click",
            function () {


                //idContenedor
                           //     int IdContenedor,           string PersonalSeleccionado, string FolioInicial, string FolioFinal, int TotalFormasAsignadas)
                var DatosEnviar = "{'IdContenedor':'"+idContenedor+"','PersonalSeleccionado':'"+personalSeleccionado.value+"','FolioInicial':'"+FInicial.value+"','FolioFinal':'"+FFinal.value+"','TotalFormasAsignadas':'"+TotalFormasAsignadas+"'}";

                console.log(DatosEnviar);


                // console.log(DatosEnviar);


                 $.ajax({
                    url: '@Url.Action("GuardarAjuste", "Inventario")',
                    data: DatosEnviar,
                    type: "POST",
                    contentType: "application/json; charset=utf-8",

                    success: function (msg) {
                        console.log("msg", msg);
                        console.log("msg", msg.length);

                        $('#AsignarFolios').modal('hide');

                        Swal.fire({
                            backdrop: true,

                            allowEnterKey: false,
                            icon: 'success',
                            title: 'Guardado exitoso',
                            text : 'Folios Asignados Correctamente'



                        }).then((result) => {
                            if (result.value) {

                                location.reload();

                                //$('#Confirmar').modal('hide')
                            }
                        })


                    },
                    error: function (msg) {
                        Swal.fire({
                            backdrop: true,

                            allowEnterKey: false,
                            icon: 'error',
                            title: 'No se pudo Asignar las formas de pago correctamente intentelo de nuevo mas tarde o pongase en contacto con el administrador del sistema',


                        })
                    }
                });

            }
        );*@



















      });







</script>