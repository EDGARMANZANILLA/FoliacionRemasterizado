@{
    ViewBag.Icono = "fas fa-boxes";
    ViewBag.Title = "Agregar";


}


<section>
    <div class="col-12 text-center">
        <h5 class=" text-uppercase"> Ingresar Nuevos Folios de Formas de Pagos para: </h5>
    </div>

    <div class="col-12">
        <div class="text-center">
            <h3 class="text-capitalize" id="Banco">@ViewBag.NombreBancoSeleccionado</h3>
        </div>

    </div>


</section>


<section class="card margenSection" id="PrimerosDatos">
    <br />
    <div class="col-12 text-center">
        <h5 class=" text-uppercase"> Ingrese los siguientes campos: </h5>
    </div>

    <div class="offset-1 col-10" style="background:#E6E6E6">
        <br />
        <div class="row">


            <label class="col-12          col-sm-5 text-sm-right">Numero de orden: </label>
            <input id="NumOrden" class="offset-1 col-10 col-sm-6 offset-sm-0" placeholder="Ingresa el Numero de orden" autofocus type="text" pattern="[A-Za-z0-9]" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " />

        </div>
        <br />
        <div class="row">

            <label class="         col-12 col-sm-5 text-sm-right">Numero de contenedores: </label>
            <input id="NumContenedor" class="offset-1 col-10 col-sm-6 offset-sm-0" placeholder="Ingresa el Numero de contenedores" autofocus pattern=" 0+\.[0-9]*[1-9][0-9]*$" onkeypress="return event.charCode >= 48 && event.charCode <= 57" />

        </div>
        <br />
        <button type="button" class="col-12 text-center offset-md-3 col-md-6 btn btn-success" onclick="Continuar()">
            Continuar
        </button>
        <br />
    </div>
    <br />
</section>



<section class="card margenSection" id="Contenedores">
    <br />
    <div class="col-12 text-center">
        <label class=" text-uppercase text-justify"> Ingrese los datos correspondientes a cada contenedor de la orden ingresada en la seccion anterior </label>
    </div>



    <!--Datos del contenedor -->
    <div class=" offset-1 col-10" style="background:#E6E6E6;">
        <br />
        <h4 class="col-12 text-center">Nuevo Contenedor</h4>
        <h4 id="IteradorContenedor" class="col-12 text-center"></h4>
        <div class="row ">
            <label class="offset-1 col-10             col-sm-2">Folio Inicial:</label>
            <input id="FolioI" class="offset-1 col-10 offset-sm-0 col-sm-3" placeholder="Ingresa el F. inicial" type="text" pattern="[A-Za-z0-9]" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " />
            <label class="offset-1 col-10 offset-sm-0 col-sm-2">Folio Final:</label>
            <input id="FolioF" class="offset-1 col-10 offset-sm-0 col-sm-3" placeholder="Ingresa el F. Final" type="text" pattern="[A-Za-z0-9]" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " />

        </div>
        <br />
        <div class="row">
            <label class="offset-1 col-5 text-right">Total de formas:</label>
          <!--  <label class="col-4 text-left" title="Calculo del total de formas"> {Total de formas}</label> -->
        </div>


    </div>
    <br />
    <button type="button" class="col-12 text-center offset-md-4 col-md-4 btn btn-outline-warning" onclick="Atras();">
        Atras
    </button>
    <br />
    <button id="Agregar" type="button" class="col-12 text-center offset-md-4 col-md-4 btn btn-outline-success" onclick="AgregarContenedor()">
        Agregar Contenedor
    </button>
    <br />

</section>






<br />
<br />
<section class="margenSection table-responsive" id="TablaDeContenedores">

    <table class="table table-striped table-bordered table-hover">
        <caption id="TituloDeCaption"></caption>
        <thead>
            <tr>
                <th>Contenedor</th>
                <th>Folio Inicial</th>
                <th>Folio Final</th>
                <th>Total de Formas de pago</th>


            </tr>
        </thead>

        <tbody id="prueba">

            <template id="temp">
                <tr>

                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>

                </tr>

            </template>



        </tbody>
    </table>





</section>

<br />
<br />
<button type="button" id="Guardar" class="btn btn-primary col-10 offset-1" onclick="EnviarDatos()">Guardar Contenedores Existentes</button>
<br />
<br />






<!-- Modal de Ediciion -->
<section class="modal fade" id="EditarContenedor" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">




                <section class="col-11">
                    <div class="row text-center">
                        <div class="offset-1 col-10  text-center">
                            <h5 class="modal-title"> Editar contenedor </h5>
                        </div>
                    </div>





                </section>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>





            </div>



            <div id="TextoConfrimacion" class="modal-body">
                <div class=" offset-1 col-10" style="background:#E6E6E6;">
                    <br />
                    <h4 class="col-12 text-center">Editar Contenedor</h4>
                    <h4 class="col-12 text-center" id="NumeroContenedor"></h4>
                    <div class="row ">
                        <label class="offset-1 col-10             col-sm-2">Folio Inicial:</label>
                        <input id="FolioInicial" class="offset-1 col-10 offset-sm-0 col-sm-3" placeholder="Ingresa el F. inicial" type="text" pattern="[A-Za-z0-9]" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " />
                        <label class="offset-1 col-10 offset-sm-0 col-sm-2">Folio Final:</label>
                        <input id="FolioFinal" class="offset-1 col-10 offset-sm-0 col-sm-3" placeholder="Ingresa el F. Final" type="text" pattern="[A-Za-z0-9]" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " />

                    </div>
                    <br />
                    <div class="row">
                        <label class="offset-1 col-5 text-right">Total de formas:</label>
                     <!--   <label class="col-4 text-left" title="Calculo del total de formas"> {Total de formas}</label> -->
                    </div>


                </div>


            </div>


            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="GuardarEdicion()">Guardar</button>




            </div>


        </div>
    </div>
</section>









<script>
    document.getElementById("TablaDeContenedores").style.display = "none"
    document.getElementById("Contenedores").style.display = "none"
    document.getElementById("Guardar").style.display = "none"



    var input = $("#NumContenedor");
    var contenido = $("#IteradorContenedor");
    let IteradorDeContenedores = 1;
    let listaDeContenedores = new Array();


    let NumOrden = null;
    let NumContenedor = null;
    let FInicial = null;
    let FFinal = null;
    let TotalFormas = null;

    let contador = 0;





    input.keyup(function () {
        console.log(`${IteradorDeContenedores}` + ` ` + `de` + ` ` + input.val()); //verificamos en consola

        contenido.html(`${IteradorDeContenedores}` + ` ` + `de` + ` ` + input.val());
        //NumContenedor = input.val();

    });

    /*   acciones de ocultamiento y desbloqueo de partes*/

    function Continuar() {

        NumOrden = document.getElementById("NumOrden").value;

        NumContenedor = document.getElementById("NumContenedor").value;

        console.log(NumOrden);
        console.log(NumContenedor);

        if (NumOrden != null && NumOrden != "" && NumContenedor != null && NumContenedor != "") {

            document.getElementById("PrimerosDatos").style.display = "none"
            document.getElementById("TablaDeContenedores").style.display = "block"
            document.getElementById("Contenedores").style.display = "block"
            document.getElementById("Guardar").style.display = "block"



            document.getElementById("TituloDeCaption").innerHTML = `Contenedores agregados al numero de orden :  ${NumOrden}`;


        } else {
            Swal.fire({
                backdrop: true,

                allowEnterKey: false,
                icon: 'error',
                title: 'Oops...',
                text: 'llene los datos faltantes para continuar'

            });
        }


    }



    function Atras() {
        NumContenedor = null;
        document.getElementById("PrimerosDatos").style.display = "block"
        document.getElementById("TablaDeContenedores").style.display = "none"
        document.getElementById("Contenedores").style.display = "none"
    }

    /****  funciones para interactividad  ******* */
    let NumeroContenedorEditar = null;

    function Editar(IdContenedor) {
        console.log("element" + IdContenedor);
        NumeroContenedorEditar = IdContenedor;

        document.getElementById("NumeroContenedor").innerHTML = `Numero : ${IdContenedor}`;

    }


    function GuardarEdicion() {

        FInicial = $('#FolioInicial').val();
        FFinal = $('#FolioFinal').val();
        TotalFormas = (FFinal - FInicial) + 1;

        if (parseInt(FFinal) > parseInt(FInicial)) {
            const remplezarFila = document.getElementById("prueba");
            const FilaARemplazar = remplezarFila.children[NumeroContenedorEditar];


            tr = document.createElement('tr');
            // tr.id = IteradorDeContenedores;
            // document.getElementById("prueba").appendChild(tr);



            td = document.createElement('td');
            tr.id = NumeroContenedorEditar;
            td.innerHTML = '<a id="id">' + NumeroContenedorEditar + '</a> ';
            tr.appendChild(td);

            td = document.createElement('td');
            td.innerHTML = '<a>' + FInicial + '</a> ';
            tr.appendChild(td);

            td = document.createElement('td');
            td.innerHTML = '<a>' + FFinal + '</a> ';
            tr.appendChild(td);

            td = document.createElement('td');
            td.innerHTML = '<a>' + TotalFormas + '</a>';
            tr.appendChild(td);


            td = document.createElement('td');
            td.innerHTML = ' <button type="button" class="btn btn-success" id="Edit" data-toggle="modal" data-target="#EditarContenedor" onclick="Editar(' + tr.id + ')">Editar</button>';
            tr.appendChild(td);

            remplezarFila.replaceChild(tr, FilaARemplazar);

            $('#EditarContenedor').modal('hide');
            $('#FolioInicial').val('');
            $('#FolioFinal').val('');


            listaDeContenedores[NumeroContenedorEditar - 1].FInicial = parseInt(FInicial);
            listaDeContenedores[NumeroContenedorEditar - 1].FFinal = parseInt(FFinal);
            listaDeContenedores[NumeroContenedorEditar - 1].TotalFormas = parseInt(TotalFormas);

            console.log(listaDeContenedores[NumeroContenedorEditar - 1]);

        } else {
            Swal.fire({
                backdrop: true,

                allowEnterKey: false,
                icon: 'error',
                title: 'Oops...',
                text: 'Verifique los datos del contenedor! EL Folio Final debe de ser mayor al Folio Inicial'

            })

        }

    }


    function ContenedoresAgregados(IteradorDeContenedores, FInicial, FFinal, TotalFormas) {
        var td;
        var tr;


        tr = document.createElement('tr');
        let a = tr.id = IteradorDeContenedores;
        document.getElementById("prueba").appendChild(tr);



        td = document.createElement('td');
        td.innerHTML = '<a id="id">' + IteradorDeContenedores + '</a> ';
        tr.appendChild(td);

        td = document.createElement('td');
        td.innerHTML = '<a>' + FInicial + '</a> ';
        tr.appendChild(td);

        td = document.createElement('td');
        td.innerHTML = '<a>' + FFinal + '</a> ';
        tr.appendChild(td);

        td = document.createElement('td');
        td.innerHTML = '<a>' + TotalFormas + '</a>';
        tr.appendChild(td);


        td = document.createElement('td');
        td.innerHTML = ' <button type="button" class="btn btn-success" data-toggle="modal" data-target="#EditarContenedor" onclick="Editar(' + tr.id + ')">Editar</button>';
        tr.appendChild(td);


    }







    function AgregarContenedor() {
        if (input != null || input != "") {

            if (IteradorDeContenedores <= input.val()) {

                contenido.html(`${IteradorDeContenedores}` + ` ` + `de` + ` ` + input.val());

                FInicial = $('#FolioI').val();
                FFinal = $('#FolioF').val();

                if (parseInt(FInicial) != null && parseInt(FFinal) != null) {



                    if (parseInt(FFinal) > parseInt(FInicial)) {
                        console.log("entreee ff es mayor igual");
                        TotalFormas = (FFinal - FInicial) + 1;
                        listaDeContenedores.push({ IteradorDeContenedores, FInicial, FFinal, TotalFormas });
                        ContenedoresAgregados(IteradorDeContenedores, FInicial, FFinal, TotalFormas);

                        $('#FolioI').val('');
                        $('#FolioF').val('');

                        ++IteradorDeContenedores

                        if (IteradorDeContenedores <= parseInt(input.val())) {
                            contenido.html(`${IteradorDeContenedores}` + ` ` + `de` + ` ` + input.val());
                        }



                    } else {
                        Swal.fire({
                            backdrop: true,

                            allowEnterKey: false,
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Verifique los datos del contenedor! EL Folio Final debe de ser mayor al Folio Inicial'

                        })

                    }


                }


            } else {
                Swal.fire({
                    backdrop: true,

                    allowEnterKey: false,
                    icon: 'warning',
                    title: 'Oops...',
                    text: 'No se pueden agregar mas contenedores. Cambie el numero de contenedores al inicio'

                })
            }

        }

    }



    function EnviarDatos()
    {

        console.log(listaDeContenedores);
        let banco = " @ViewBag.NombreBancoSeleccionado ";

       //NumOrden = document.getElementById("NumOrden").value;

        console.log(NumOrden);
        console.log(banco);
          $.ajax({
              url: '@Url.Action("GuardarInventarioAgregado", "Inventario")',
              data: JSON.stringify({ listaDeContenedores, NumOrden, banco }),
            type: "POST",
            contentType: "application/json; charset=utf-8",

            success: function (msg) {
                console.log("msg", msg);
                if (msg == true) {


                    Swal.fire({
                        backdrop: true,

                        allowEnterKey: false,
                        icon: 'success',
                        title: 'Correcto',
                        text: `Se han agregado nuevos contenedores a ${banco}`

                    }).then((result) => {
                            if (result.value) {
                               location.reload();

                            }
                    })

                } else {
                    Swal.fire({
                        backdrop: true,

                        allowEnterKey: false,
                        icon: 'error',
                        title: 'No se pudo guardar correctamente',


                    })
                }
              },
              error: function (msg) {
                  Swal.fire({
                      backdrop: true,

                      allowEnterKey: false,
                      icon: 'info',
                      title: 'Verifique su coneccion',


                  })
              }
          });









    }


</script>