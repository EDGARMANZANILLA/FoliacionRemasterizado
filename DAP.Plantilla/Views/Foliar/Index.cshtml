@model List<DAP.Plantilla.Models.FoliacionModels.DetallesBancoInventario>


<section class="row">

    <div class="col-12 col-md-6">



        <!--Nuevo modal-->
        <!-- Cascaron de tabla para luego llenarla con datos desde la DB -->
    
            <div >

                <div id="TablaResumenInventario">

                    <table id="NuevaTablaInventarioActualizada" class='table table-striped table-bordered table-hover' >
                        <caption class="text-uppercase"> Formas De Pago Disponible </caption>
                        <thead class="tabla">
                            <tr class="text-center text-uppercase">

                                <th>Banco</th>
                                <th>Cuenta</th>
                                <th>Formas Disponibles</th>

                            </tr>


                        </thead>
                       




                    </table>

                </div>
            </div>
   






    </div>



    <div class="col-12 col-md-6">
        @*<table class='table table-striped table-bordered '>

            <caption class="text-uppercase"> Ultima Quincena Registrada </caption>

            <tbody class="text-center azul">
                <tr>
                    <td>2111</td>
                </tr>

            </tbody>
        </table>*@






        <div id="TablaQuincenas">

            <table id="UltimaQuincenaFoliada" class='table table-striped table-bordered table-hover'>
                <caption class="text-uppercase">ultima quincena resgistrada </caption>
                <thead class="tabla">
                    <tr class="text-center text-uppercase">

                        <th>Banco</th>

                    </tr>


                </thead>


                <tbody class="text-center azul">
                    <tr>
                        <td>@ViewBag.UltimaQuincenaEncontrada</td>
                    </tr>

                </tbody>


            </table>

        </div>

    </div>

</section>








<!-- Eleccion de la manera con la que se desea foliar si pagomatico o cheques -->
<seccion class="margenSection  card col-12  offset-md-2 col-md-8 text-center" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">

    <div class="margenSection row">

        <div class="btn-block">
            <h3>NUEVA QUINCENA A FOLIAR</h3>
            <h3>Ingresa la quincena a foliar:</h3>
            <br />
        </div>

        <div class=" col-12 text-center">
            <input id="Quincena" class="offset-1 col-10 offset-sm-0 col-sm-6 input" placeholder="Nueva quincena a foliar" type="text" onkeypress="return event.charCode >= 48 && event.charCode <= 122 && event.charCode != 91 " autofocus />
        </div>

        <div class="col-12 offset-md-2 col-md-8 text-center">
            <div class="form-group">
                <br />
                <br />
                <select class="form-control " id="SeleccionarTipoFoliacion" required>
                    <option value="" disabled selected>Selecciona un tipo de foliacion...</option>
                    <option> PAGOMATICO</option>
                    <option> FORMAS DE PAGO</option>
                </select>
            </div>
        </div>


        <div class="col-12 text-center">
            <br />
            <button id="Continuar" type="button" class="btn btn-lg btn-success"><i class="far fa-hand-point-right"></i> Continuar</button>

        </div>


    </div>



</seccion>












<!-- Modal -->
<div class="modal fade" id="ModalPDFVisualizador" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title col-11 text-capitalize text-center" id="NombreNominaDelegacion">{}</h5>
                <button type="button" class="close btn-primary" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div>

                    <div id="example" class="altura">

                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>

            </div>
        </div>
    </div>
</div>



<div id="RenderVistaParcial">

</div>






<style>
    .margenSection {
        margin-top: 60px;
        margin-bottom: 60px;
    }

    .linea {
        border: solid brown;
        border-radius: 22px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    }


    .sombra {
        background: #E6E6E6;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        display: none;
    }


    caption {
        background: #f9fcf9;
        color: black;
        font-weight: bold;
        text-align: center;
        caption-side: top;
        font-size: 18px;
    }

    .tabla {
        text-align: center;
        background: #74BC7C;
    }

    .azul {
        color: blue;
        font-weight: bold;
        text-align: center;
        caption-side: top;
        font-size: 30px;
    }



    .input {
        width: 250px;
        height: 45px;
        color: blue;
        text-align: center;
        border-radius: 10px;
        background-color: rgb(219, 250, 235);
        border: 2px solid rgb(19, 168, 243);
        font-weight: bold;
        font-size: 18px;
        box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.08);
    }


    .container {
        background: gray;
        min-height: 100vh;
    }



    .altura {
        height: 100vh;
        border: solid;
    }

    .pdfobject-container {
        height: 100vh;
        border: 1rem solid rgba(0,0,0,.1);
    }
</style>

<script>
    function RegistarNuevaQuincena() {

        Swal.fire({
            title: 'Registrar nueva quincena de foliacion',
            input: 'text',
            inputAttributes: {
                autocapitalize: 'off'
            },
            showCancelButton: true,
            confirmButtonText: 'Registrar',
            cancelButtonText: 'Cancelar',
            showLoaderOnConfirm: true,
            preConfirm: (login) => {

          
                let EnviarQuincena = "{'NuevaQuincesa': '" + 2115 + "'}";


                    MensajeCargando();
                    $.ajax({
                        url: '@Url.Action("RegistrarNuevaQuincena", "Foliar")',
                        data: EnviarQuincena,
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        success: function (response) {


                            //alert(response);
                            OcultarMensajeCargando();

                            MensajeCorrectoSweet("QUINCENA GUARDADA CORRECTAMENTE");











                           

                        }

                   });

               

            },
            allowOutsideClick: () => !Swal.isLoading()
        });


    }



    function DibujarTablaResumenInventario() {
        $("#TablaResumenInventario").append(

            "<table id='NuevaTablaInventarioActualizada'  class='table table-striped display table-bordered table-hover' cellspacing='0'  style='width:100%'>" +
            " <caption class='text-uppercase'>Formas de pago disponible</caption>"
            + "<thead class='tabla'>" +

            "<tr class='text-center text-uppercase'>" +

            "<th>Banco</th>" +
            "<th>Cuenta</th>" +
            "<th>Formas de pago disponibles</th>" +

            "</tr>" +
            "</thead>" +
            "</table>"
        );
    };


    function PintarConsultaActualizaTablaResumenInventario(datos) {



        $('#NuevaTablaInventarioActualizada').DataTable({
            "ordering": true,
            "info": false,
            "searching": false,
            "paging": false,
            "lengthMenu": [5, 10],
            "language":
            {
                "processing": "Procesando...",
                "lengthMenu": "Mostrar _MENU_ registros",
                "zeroRecords": "No se encontraron resultados",
                "emptyTable": "Ningún dato disponible en esta tabla",
                "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "search": "Buscar:",
                "info": "Mostrando de _START_ a _END_ de _TOTAL_ entradas",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            },
            "data": datos,
            "columns": [
                { "data": "NombreBanco" },
                { "data": "Cuenta" },
                { "data": "FormasDisponibles" }

            ],
            "order": [[1, 'asc']]

        });

    };







    function DibujarTablaAjax() {
        $("#TablaActualizada").append(

            "<table id='NominasFoliadas' class='table table-striped table-bordered table-hover' cellspacing='0' style='width:60%'>" +
            " <caption class='text-uppercase'>Nominas Foliadas </caption>"
            + "<thead class='tabla'>" +

            "<tr>" +

            "<th>Nomina foliada</th>" +
            "<th>Revisar</th>" +
            "</tr>" +
            "</thead>" +

            "</table>"
        );
    };

    let tablaNominasFoliadas;
    function PintarConsultas(datos) {

        tablaNominasFoliadas = $('#NominasFoliadas').DataTable({
            "ordering": false,
            "info": false,
            "searching": false,
            "paging": false,
            "lengthMenu": [10, 15],
            "language":
            {
                "processing": "Procesando...",
                "lengthMenu": "Mostrar _MENU_ registros",
                "zeroRecords": "No se encontraron resultados",
                "emptyTable": "Ningún dato disponible en esta tabla",
                "infoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "search": "Buscar:",
                "info": "Mostrando de _START_ a _END_ de _TOTAL_ entradas",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                }
            },
            "data": datos,
            "columns": [

                { "data": "NombreNomina" },
                {

                    "render": function (data, type, row) {
                        //let da = row;
                        return '<button class="mostrarPDF btn btn-success" >Ver detalles </button>';
                    }

                }


            ],
            "order": [[1, 'asc']]
        });

    };




    $(document).ready(function () {
      //  RegistarNuevaQuincena();

        ActualizaTablaResumenFoliar();

        //if (document.readyState !== "complete")
        //{
        //    ActualizaTablaResumenFoliar();
        //}


        function ActualizaTablaResumenFoliar()
        {
            var datoEnviar = "{'Dato':' '}";

            MensajeCargando();
              $.ajax({
                  url: '@Url.Action("ActualizarTablaResumenBanco", "Foliar")',
                  data: datoEnviar,
               type: "POST",
               contentType: "application/json; charset=utf-8",
                  success: function (response) {


                   //estos metodos se encuentran el Js del Index de Foliar sirve para actualizar la tabla al terminar de folear
                   $("#TablaResumenInventario").empty();
                   DibujarTablaResumenInventario();
                   PintarConsultaActualizaTablaResumenInventario(response);

                   OcultarMensajeCargando();

                }

              });

        }


        let tipoFoliacion = null;
        const FoliacionSeleccionada = document.getElementById("SeleccionarTipoFoliacion");
        FoliacionSeleccionada.addEventListener("change",
            function () {

                tipoFoliacion = this.options[FoliacionSeleccionada.selectedIndex];

                console.log(tipoFoliacion.value);
            }
        );


        // detecta cambios en el nombre del personal
        let quincena = "";
        const Continuar = document.getElementById("Continuar");
        Continuar.addEventListener("click",
            function () {

                quincena = document.getElementById("Quincena").value;
                if (tipoFoliacion != null && quincena != "")
                {

                      //devuelve la vista parcial de pagomatico para el nuevo render
                    if (tipoFoliacion.value == "PAGOMATICO")
                    {

                        let EnviarQuincenaPagomatico = "{'NumeroQuincena': '" + quincena + "'}";


                         MensajeCargando();
                        $.ajax({
                            url: '@Url.Action("FoliarXPagomatico", "Foliar")',
                            data: EnviarQuincenaPagomatico,
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            success: function (response) {

                                if (response.RespuestaServidor === "500") {
                                    MensajeErrorSweet(response.MensajeError);
                                    $('#RenderVistaParcial').html('');
                                } else {
                                    $('#RenderVistaParcial').html('');
                                    $('#RenderVistaParcial').html(response);

                                }



                                OcultarMensajeCargando();
                            }
                        });


                    }

                    //devuelve la vista parcial de formas de pago para el nuevo render
                    if (tipoFoliacion.value == "FORMAS DE PAGO"){

                         let EnviarQuincenaFormasPago = "{'NumeroQuincena': '"+quincena+"'}";

                        MensajeCargando();
                        $.ajax({
                            url: '@Url.Action("FoliarXFormasPago", "Foliar")',
                            data: EnviarQuincenaFormasPago,
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            success: function (response) {

                                if (response.RespuestaServidor === "500") {
                                    MensajeErrorSweet(response.MensajeError);
                                    $('#RenderVistaParcial').html('');
                                } else {

                                    $('#RenderVistaParcial').html('');
                                    $('#RenderVistaParcial').html(response);

                                }





                                OcultarMensajeCargando();
                            }
                        });

                    }






                } else {
                    Swal.fire({
                        backdrop: true,
                        allowEnterKey: false,
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        icon: 'warning',
                        title: '',
                        text: `Asegurese de ingresar un numero de quincena y un tipo de foliacion para continuar`
                    });

                }


            }
        );













        //Revisiones con nominaAfoliar


        //const Revisar = document.getElementById('Revisar');
        //Revisar.addEventListener('click', function () {

        //    if (seleccionNomina == true && seleccionTodasNominas == false) {

        //        console.log(nominaSeleccionadaFoliar);

        //        if (nominaSeleccionadaFoliar != null) {
        //            //Enviar datos al servidor x nomina
        //            //
        //            //Crear pdf, ponerlo en una carpeta temporal y mostrarle un visualizador para que lo vea y decida que hacer
        //            // con el pdf
        //            //peticion ajax
        //            // nominasFoliadas.push(nominaSeleccionadaFoliar.value);
        //            // PintarTablaNominasFoliadas(nominasFoliadas);
        //            $("example").empty();
        //            PDFObject.embed("Solicitud.pdf", "#example");
        //            $('#ModalPDFVisualizador').modal('show');


        //        } else {

        //            Swal.fire({
        //                backdrop: true,
        //                allowEnterKey: false,
        //                allowOutsideClick: false,
        //                allowEscapeKey: false,
        //                icon: 'warning',
        //                title: '',
        //                text: `Elija un tipo de nomina para continuar`
        //            });
        //        }


        //    } else if (seleccionNomina == false, seleccionTodasNominas == true) {
        //        //Enviar datos al servidor para hacer la peticion de todas las nominas ya que es por pagomatico
        //        //Crear pdf, ponerlo en una carpeta temporal y mostrarle un visualizador para que lo vea y decida que hacer
        //        // con el pdf
        //        //peticion ajax

        //    } else {
        //        Swal.fire({
        //            backdrop: true,
        //            allowEnterKey: false,
        //            allowOutsideClick: false,
        //            allowEscapeKey: false,
        //            icon: 'warning',
        //            title: '',
        //            text: `Selecciona una opcion para continuar`
        //        });

        //    }


        //});


        //const Foliar = document.getElementById('RealizarFoliacion');
        //Foliar.addEventListener('click', function () {

        //    if (seleccionNomina == true && seleccionTodasNominas == false) {

        //        console.log(nominaSeleccionadaFoliar);

        //        if (nominaSeleccionadaFoliar != null) {
        //            //Enviar datos al servidor x nomina
        //            //
        //            //Crear pdf, ponerlo en una carpeta temporal y mostrarle un visualizador para que lo vea y decida que hacer
        //            // con el pdf
        //            //peticion ajax
        //            nominasFoliadas.push({ "NombreNomina": nominaSeleccionadaFoliar.value });

        //            $("#TablaActualizada").empty();
        //            DibujarTablaAjax();
        //            PintarConsultas(nominasFoliadas);
        //            console.log(nominasFoliadas);




        //        } else {

        //            Swal.fire({
        //                backdrop: true,
        //                allowEnterKey: false,
        //                allowOutsideClick: false,
        //                allowEscapeKey: false,
        //                icon: 'warning',
        //                title: '',
        //                text: `Elija un tipo de nomina para continuar`
        //            });
        //        }


        //    } else if (seleccionNomina == false, seleccionTodasNominas == true) {
        //        //Enviar datos al servidor para hacer la peticion de todas las nominas ya que es por pagomatico
        //        //Crear pdf, ponerlo en una carpeta temporal y mostrarle un visualizador para que lo vea y decida que hacer
        //        // con el pdf
        //        //peticion ajax

        //    } else {
        //        Swal.fire({
        //            backdrop: true,
        //            allowEnterKey: false,
        //            allowOutsideClick: false,
        //            allowEscapeKey: false,
        //            icon: 'warning',
        //            title: '',
        //            text: `Selecciona una opcion para continuar`
        //        });

        //    }


        //});




        //$(document).on("click", ".mostrarPDF", function () {

        //    let datosFilaSeleccionada = tablaNominasFoliadas.row($(this).parents("tr")).data();

        //    console.log(datosFilaSeleccionada);

        //    $("example").empty();
        //    PDFObject.embed("Solicitud.pdf", "#example");
        //    document.getElementById('NombreNomina').innerHTML = datosFilaSeleccionada.NombreNomina;
        //    $('#ModalPDFVisualizador').modal('show');


        //});








    });

    function InhabilitarFolios() {
        $("#divTablaSubir").empty();
        let InhabilitarFolios = document.getElementById('InhabilitarFolios').classList.remove('btn-outline-primary');
        InhabilitarFolios = document.getElementById('InhabilitarFolios').classList.add('btn-primary');


        let seccionDetalle = document.getElementById('Detalle').classList.remove('btn-primary');
        seccionDetalle = document.getElementById('Detalle').classList.add('btn-outline-primary');


        document.getElementById("DetalleInhabilitacion").style.display = "none";


        document.getElementById("IFolios").style.display = "block";


        //deshabilita el boton para enviar datos al server por contenedor y solo envia los ihabilitados
        document.getElementById("GuardarInhabilitadosContenedor").style.display = "none";
        document.getElementById("GuardarInhabilitados").style.display = "block"


    }

    function Detalle() {

        let detalle = document.getElementById('Detalle').classList.remove('btn-outline-primary');
        detalle = document.getElementById('Detalle').classList.add('btn-primary');

        let InhabilitarFolios = document.getElementById('InhabilitarFolios').classList.remove('btn-primary');
        InhabilitarFolios = document.getElementById('InhabilitarFolios').classList.add('btn-outline-primary');


        document.getElementById("IFolios").style.display = "none";
        document.getElementById("DetalleInhabilitacion").style.display = "block";
    }







</script>